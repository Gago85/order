<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>GoodBuns Заказ (Защищён)</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #bdbdbd url('https://www.transparenttextures.com/patterns/stardust.png');
            padding: 20px;
            background-attachment: fixed;
        }
        .container {
            max-width: 700px;
            margin: auto;
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 5px 25px rgba(0, 0, 0, 0.2);
        }
        .logo {
            display: block;
            margin: 0 auto 20px;
            max-width: 200px;
        }
        h1, h2 {
            text-align: center;
            margin-bottom: 10px;
        }
        input[type="text"], input[type="number"], select, button {
            width: 100%;
            padding: 10px;
            margin: 5px 0;
            border-radius: 6px;
            border: 1px solid #ccc;
        }
        .add-btn {
            background: #444;
            color: white;
            border: none;
            padding: 10px;
            margin-top: 10px;
            cursor: pointer;
            border-radius: 6px;
            transition: background 0.3s;
        }
        .add-btn:hover {
            background: #222;
        }
        .section-title {
            font-weight: bold;
            margin-top: 20px;
        }
        .dropdown-group {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }
        .dropdown-group select,
        .dropdown-group input {
            flex: 1;
        }
    </style>
</head>
<body>
<div class="container" id="auth">
    <h2>Вход в систему</h2>
    <p>Введите PIN-код:</p>
    <input type="text" id="access-code" placeholder="PIN">
    <button onclick="checkCode()">Войти</button>
</div>

<div class="container" id="main-form" style="display:none;">
    <img src="https://storage.googleapis.com/personal-web-bucket-public/goodbuns_logo.png" alt="GoodBuns Logo" class="logo">
    <h1>GoodBuns Заказ</h1>
    <label>Выберите точку:</label>
    <select id="point">
        <option>Магистраль</option>
        <option>Омега</option>
        <option>Гефест</option>
        <option>Черри</option>
        <option>Холл</option>
    </select>

    <label>День недели:</label>
    <select id="day">
        <option>Пн</option>
        <option>Вт</option>
        <option>Ср</option>
        <option>Чт</option>
        <option>Пт</option>
    </select>

    <h3 class="section-title">Сиропы</h3>
    <div id="syrup-block"></div>
    <button type="button" class="add-btn" onclick="addDropdown('syrup-block', syrups)">+ Добавить сироп</button>

    <h3 class="section-title">Топпинги</h3>
    <div id="topping-block"></div>
    <button type="button" class="add-btn" onclick="addDropdown('topping-block', toppings)">+ Добавить топпинг</button>

    <h3 class="section-title">Альтернативное молоко</h3>
    <div id="milk-block"></div>
    <button type="button" class="add-btn" onclick="addDropdown('milk-block', milk)">+ Добавить молоко</button>

    <h3 class="section-title">Чай</h3>
    <div id="tea-block"></div>
    <button type="button" class="add-btn" onclick="addDropdown('tea-block', tea)">+ Добавить чай</button>

    <h3 class="section-title">Напитки</h3>
    <div id="drink-block"></div>
    <button type="button" class="add-btn" onclick="addDropdown('drink-block', drinks)">+ Добавить напиток</button>

    <h3 class="section-title">Стаканы и крышки</h3>
    <div id="cups-block"></div>
    <button type="button" class="add-btn" onclick="addDropdown('cups-block', cups)">+ Добавить стакан/крышку</button>

    <h3 class="section-title">Химия</h3>
    <div id="chemistry-block"></div>
    <button type="button" class="add-btn" onclick="addDropdown('chemistry-block', chemistry)">+ Добавить</button>

    <h3 class="section-title">Уборочный инвентарь</h3>
    <div id="cleaning-block"></div>
    <button type="button" class="add-btn" onclick="addDropdown('cleaning-block', cleaning)">+ Добавить</button>

    <h3 class="section-title">Расходники</h3>
    <div id="supplies-block"></div>
    <button type="button" class="add-btn" onclick="addDropdown('supplies-block', supplies)">+ Добавить</button>

    <h3 class="section-title">Ингредиенты</h3>
    <div id="ingredients-block"></div>
    <button type="button" class="add-btn" onclick="addDropdown('ingredients-block', ingredients)">+ Добавить</button>

    <button onclick="submitOrder()" class="add-btn">Отправить заказ</button>
</div>

<script>
    const syrups = ["Солёная карамель", "Карамель", "Ваниль", "Банан", "Шоколад", "Клубника", "Hazel Nut", "Фисташковый", "Маракуйя", "Лаванда", "Яблочный пирог", "Кокос", "Мята", "Малина", "Апельсин"];
    const toppings = ["Топпинг Банан", "Топпинг Шоколад", "Топпинг Карамель", "Сгущенное молоко", "Мороженое"];
    const milk = ["Кокосовое", "Соевое", "Миндальное", "Фундучное"];
    const tea = ["Матча", "Ягодный", "Клюквенный", "Облепиховый", "Шиповник", "Имбирный", "Маракуйя", "Малина", "ЭрлГрей", "Сенча", "Мята", "Пряный Чай 250г"];
    const drinks = ["БонАква 0.5", "Кола 0.5", "Мевер, Татни", "Апельсиновый сок 1л", "Тоник", "Вода Газ 1,5л"];
    const cups = ["Стакан 0.2", "Стакан 0.3", "Стакан 0.4", "Стакан Шейк 0.4", "Крышки 80", "Крышки 90", "Крышки Шейк"];
    const chemistry = ["Мусорные 240л", "Стекломой", "Cafiza 1кг", "Губка"];
    const cleaning = ["Тряпки половые", "Насадка для швабры", "Веник", "Совок"];
    const supplies = ["Трубочки", "Пакеты Майка", "Мешалки", "Ложки", "Вилки", "Бумажные пакеты 1к", "Салфетки шт.", "Зева уп.", "Контейнера RK 50шт.", "Подставка 2х 50", "Подставка 4х 50шт.", "Пергамент", "Тряпка из микрофибры", "Фильтры для Bovilor 50шт", "Лента Кассовая 80на80"];
    const ingredients = ["Гвоздика", "Бадьян", "Цедра", "Корица Пальчиковая", "Корица Молотая", "Сахар 1кг", "Кофе эспрессо №4", "Зерно фильтр", "Арахисовая Паста", "Какао 1кг", "Кедровые Орехи"];

    const pinMap = {
        "1111": "Магистраль",
        "2222": "Омега",
        "3333": "Гефест",
        "4444": "Черри"
    };

    function checkCode() {
        const input = document.getElementById("access-code").value.trim();
        const point = pinMap[input];

        if (point) {
            document.getElementById("auth").style.display = "none";
            document.getElementById("main-form").style.display = "block";
            document.getElementById("point").value = point;
        } else {
            alert("❌ Неверный PIN-код");
        }
    }

    function addDropdown(containerId, optionsArray) {
        const container = document.getElementById(containerId);
        const div = document.createElement("div");
        div.className = "dropdown-group";

        const select = document.createElement("select");
        optionsArray.forEach(opt => {
            const option = document.createElement("option");
            option.text = opt;
            select.add(option);
        });

        const qty = document.createElement("input");
        qty.type = "number";
        qty.min = "0";
        qty.placeholder = "Количество";

        div.appendChild(select);
        div.appendChild(qty);
        container.appendChild(div);
    }

    function submitOrder() {
        const point = document.getElementById("point").value;
        const day = document.getElementById("day").value;
        const items = [];

        [
            "syrup-block", "topping-block", "milk-block", "tea-block",
            "drink-block", "cups-block", "chemistry-block", "cleaning-block",
            "supplies-block", "ingredients-block"
        ].forEach(id => {
            document.querySelectorAll(`#${id} .dropdown-group`).forEach(div => {
                const name = div.children[0].value;
                const qty = div.children[1].value;
                if (qty && parseInt(qty) > 0) {
                    items.push({ name, qty });
                }
            });
        });

        fetch("https://server-o00c.onrender.com/order", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({ point, day, items })
        })
        .then(res => res.json())
        .then(data => {
            alert("✅ Заказ отправлен!");
            console.log(data);
        })
        .catch(err => {
            alert("❌ Ошибка при отправке заказа!");
            console.error(err);
        });
    }
</script>
</body>
</html>
